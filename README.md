# 機械可読性診断ツール

Excel/CSVファイルの機械可読性を診断するためのWebアプリケーションです。データの品質と再利用性を向上させるためのチェックリストに基づいて、3段階のレベルでファイルの診断を行います。

## 特徴

- **マルチフォーマット対応**: Excel (.xlsx/.xls) および CSV ファイルの診断
- **3段階チェック**: レベル1〜3での段階的な機械可読性診断
- **フォーマット特化**: 各ファイル形式に最適化された専用チェッカー
- **包括的エラーハンドリング**: 堅牢なエラー処理とログ機能
- **モダンなアーキテクチャ**: ファクトリーパターンによる拡張性の高い設計

## 機能概要

### 診断レベル

1. **レベル1**: 基本的なフォーマット整合性チェック
2. **レベル2**: データ構造と値の妥当性チェック
3. **レベル3**: メタデータとドキュメント品質チェック

### 対応ファイル形式

- **CSV**: カンマ区切りファイル
- **XLS**: Excel 97-2003 形式
- **XLSX**: Excel 2007以降の形式

### 診断基準

以下の公的ガイドラインに基づいた診断を実施：
- [統計表における機械判読可能なデータの表記方法の統一ルール](https://www.soumu.go.jp/menu_news/s-news/01toukatsu01_02000186.html)
- [官民におけるデータの利活用について（内閣官房）](https://www.cas.go.jp/jp/seisaku/digital_gyozaikaikaku/data8/data8_siryou1.pdf)の7ページ：データの機械可読性を高めるための新しいルール

## 技術仕様

### 必要条件

- Python 3.8以上
- 必要なパッケージ（requirements.txtに記載）
- OpenAI APIキー（.streamlit/secrets.tomlファイルで設定）

### 主要依存関係

- `streamlit`: Webアプリケーションフレームワーク
- `pandas`: データ分析・処理
- `openpyxl`: Excel .xlsx ファイル処理
- `xlrd`: Excel .xls ファイル処理
- `loguru`: 高機能ログ管理

## インストール・セットアップ

### 1. リポジトリのクローン

```bash
git clone [リポジトリURL]
cd machine_readability_checker
```

### 2. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 3. 環境設定

`.streamlit/secrets.toml` ファイルを作成し、以下を記述：

```toml
OPENAI_API_KEY = "your_api_key_here"
```

## 使用方法

### アプリケーションの起動

```bash
make run
```

または

```bash
streamlit run src/app/app.py
```

### 診断の実行

1. Webブラウザでアプリケーションにアクセス
2. 診断したいファイル（.xlsx/.xls/.csv）をアップロード
3. 自動的に実行される3段階の診断結果を確認
4. 生成されたレポートをダウンロード

## プロジェクト構造

```
machine_readability_checker/
├── Makefile                   # ビルド・実行コマンド
├── requirements.txt           # Python依存関係
├── README.md                  # プロジェクト説明書
├── data/                      # アップロードファイル保存先
├── reports/                   # 診断レポート出力先
├── logs/                      # アプリケーションログ
├── rules/                     # 診断ルール定義
│   ├── level1.json           # レベル1診断ルール
│   ├── level2.json           # レベル2診断ルール
│   └── level3.json           # レベル3診断ルール
├── .streamlit/               # Streamlit設定
│   └── secrets.toml          # API キー等の機密情報
└── src/                      # ソースコード
    ├── config.py             # アプリケーション設定
    ├── app/                  # Webアプリケーション
    │   ├── app.py           # メインアプリケーション
    │   └── styles/          # UI スタイル（CSS等）
    ├── checker/              # 機械可読性診断エンジン
    │   ├── factory.py       # チェッカーファクトリー
    │   ├── router.py        # 診断ルーティング
    │   ├── base/            # 抽象基底クラス
    │   ├── csv/             # CSV専用チェッカー
    │   ├── xls/             # XLS専用チェッカー
    │   ├── xlsx/            # XLSX専用チェッカー
    │   └── utils/           # 共通ユーティリティ
    ├── processor/            # データ処理エンジン
    │   ├── loader/          # ファイル読み込み
    │   ├── table_parser.py  # テーブル構造解析
    │   ├── context.py       # コンテキスト管理
    │   └── summary.py       # 結果要約処理
    └── llm/                  # LLM（大規模言語モデル）連携
        └── llm_client.py    # LLM クライアント
```

## アーキテクチャ

### 設計思想

本プロジェクトは以下の設計原則に基づいて構築されています：

1. **分離された責任**: 各モジュールが明確な責任を持つ
2. **ファクトリーパターン**: ファイル形式に応じた適切なチェッカーの動的生成
3. **拡張性**: 新しいファイル形式や診断ルールの追加が容易
4. **堅牢性**: 包括的なエラーハンドリングとログ管理

### 主要コンポーネント

- **Factory**: `src/checker/factory.py` - チェッカーの生成と管理
- **Router**: `src/checker/router.py` - 診断処理のルーティング
- **Format-Specific Checkers**: 各ファイル形式に特化した診断ロジック
- **Logging**: Loguru による統一されたログ管理

## 開発・貢献

### ブランチ戦略

- `main`: 安定版
- `feature/*`: 新機能開発
- `fix/*`: バグ修正

### テスト

```bash
# テストスクリプトの実行
python test.py
```

### ログ確認

アプリケーションの動作ログは `logs/` ディレクトリに保存されます。

## トラブルシューティング

### よくある問題

1. **CSVファイルの文字化け**: ファイルのエンコーディングを確認してください
2. **XLSファイルの読み込みエラー**: xlrd のバージョンが適切であることを確認してください
3. **メモリ不足**: 大きなファイルの場合、チャンクサイズを調整してください

### ログの確認

詳細なエラー情報は `logs/` ディレクトリのログファイルで確認できます。

## ライセンス

[ライセンス情報を記載]

## 更新履歴

- **v2.0.0**: アーキテクチャの全面リファクタリング、フォーマット特化チェッカーの実装
- **v1.x.x**: 初期バージョン、基本機能の実装

